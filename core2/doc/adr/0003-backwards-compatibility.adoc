# 3. Backwards compatibility

Date: 2021-09-09

## Status

Superseded by:

* Tx Fns: link:0011-classic-tx-fns.adoc[ADR-0011]
* Lucene: link:0012-classic-lucene.adoc[ADR-0012]
* Pull Syntax link:0013-classic-pull.adoc[ADR-0013]
* Speculative transactions: link:0014-classic-speculative-txes.adoc[ADR-0014]
* Clojure predicates link:0015-classic-clojure-predicates.adoc[ADR-0015]
* Arbitrary Types link:0017-classic-arbitrary-types.adoc[ADR-0017]
* Datalog Rules link:0018-classic-datalog-rules.adoc[ADR-0018]
* Advanced Datalog link:0019-classic-advanced-datalog.adoc[ADR-0019]
* Migration Tool link:0020-classic-migration-tool.adoc[ADR-0020]
* Tx-ops link:0021-classic-tx-fns.adoc[ADR-0021]
* History API link:0022-classic-history-api.adoc[ADR-0022]

## Context

XTDB needs some level of compatibility with classic. At the minimum we
need to import the data and timeline.

### Transaction processing (write side)

#### Rollback

Currently c2 takes a zero-copy of the live data and present that for
queries. The easiest way to do rollbacks is to do this the other way
around. Have the transaction take a zero-copy slice, modify it (append
only) and then if it commits, replace and release (decrease the
reference count) of the previous watermark.

The temporal in-memory index is a persistent data structure, so you
wouldn't need to do anything here, just go back to the previous
version.

#### See Also

* link:0004-eviction.adoc[Eviction] assumed to be orthogonal.

## Decision

N/A. This ADR has been superceded as it is too all-encompassing. We
will need to decide on a case-by-base basis what elements of classic
compatibility we want to commit to.

## Consequences
